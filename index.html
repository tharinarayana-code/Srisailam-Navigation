<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Srisailam Smart Navigation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  #back-to-top {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
    line-height: 44px;
    text-align: center;
    font-size: 22px;
    text-decoration: none;
    background-color: #f0f0f0;
    color: #333;
    border-radius: 50%;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    z-index: 1000;
    display: none;
}

#back-to-top:hover {
    background-color: #e0e0e0;
}

  </style>
</head>
<body id="top">
<header>
<h1>Srisailam Smart Navigation</h1>
<p>Select category → choose place → navigate</p>
<div id="language-selector">
    <label for="lang">Language:</label>
    <select id="lang">
        <option value="en">English</option>
        <option value="te">తెలుగు</option>
        <option value="hi">हिंदी</option>
        <option value="ta">தமிழ்</option>
        <option value="kn">ಕನ್ನಡ</option>
        <option value="ml">മലയാളം</option>
    </select>
</div>
<div id="search-box">
    <input
        type="text"
        id="searchInput"
        placeholder="Search places, food, temples…"
    />
</div>
<div id="free-darshan-container" style="margin: 15px 0;"></div>
</header>

<!-- <hr> -->
<section id="search-results" style="display:none;">
  <h2>Search Results</h2>
  <ul id="search-list"></ul>
</section>


<main id="app"></main>
<section id="search-results" style="display:none;"></section>

<a href="#top" id="back-to-top" aria-label="Back to top">⬆</a>

<script>
/* ================= GLOBAL STATE ================= */
let locationsData = [];
let currentLang = "en";
let searchQuery = "";

/* ================= LOAD DATA ================= */
fetch("locations.json")
  .then(res => res.json())
  .then(data => {
    locationsData = data;
    searchQuery = "";

    document.getElementById("app").style.display = "block";
    document.getElementById("search-results").style.display = "none";

    renderApp();
  })
  .catch(err => console.error("Failed to load locations.json", err));

/* ================= CATEGORY LABELS ================= */
const CATEGORY_LABELS = {
  TEMPLE:{en:"Temples",te:"ఆలయాలు",hi:"मंदिर",ta:"கோவில்கள்",kn:"ದೇವಾಲಯಗಳು",ml:"ക്ഷേത്രങ്ങൾ"},
  ASHRAM:{en:"Ashrams / Mathams",te:"ఆశ్రమాలు / మఠాలు",hi:"आश्रम / मठ",ta:"ஆசிரமங்கள் / மடங்கள்",kn:"ಆಶ್ರಮಗಳು / ಮಠಗಳು",ml:"ആശ്രമങ്ങൾ / മഠങ്ങൾ"},
  ACCOMMODATION:{en:"Accommodation",te:"వసతి",hi:"आवास",ta:"தங்குமிடம்",kn:"ವಸತಿ",ml:"താമസം"},
  FOOD:{en:"Food",te:"ఆహారం",hi:"भोजन",ta:"உணவு",kn:"ಆಹಾರ",ml:"ഭക്ഷണം"},
  FACILITY:{en:"Facilities",te:"సౌకర్యాలు",hi:"सुविधाएं",ta:"வசதிகள்",kn:"ಸೌಲಭ್ಯಗಳು",ml:"സൗകര്യങ്ങൾ"},
  TRANSPORT:{en:"Transport",te:"రవాణా",hi:"परिवहन",ta:"போக்குவரத்து",kn:"ಸಾರಿಗೆ",ml:"ഗതാഗതം"},
  UTILITY:{en:"Utilities",te:"సేవలు",hi:"सेवाएं",ta:"சேவைகள்",kn:"ಸೇವೆಗಳು",ml:"സേവനങ്ങൾ"},
  TOURIST_SPOT:{en:"Tourist Spots",te:"పర్యాటక ప్రాంతాలు",hi:"पर्यटन स्थल",ta:"சுற்றுலா இடங்கள்",kn:"ಪర్యಟನಾ ಸ್ಥಳಗಳು",ml:"സഞ്ചാര കേന്ദ്രങ്ങൾ"}
};

/* ================= SEARCH MATCH ================= */
function matchesSearch(l) {
  if (!searchQuery) return true;

  const name =
    (l["name_" + currentLang] || l["display name"] || "").toLowerCase();

  const category =
    (CATEGORY_LABELS[l.category]?.[currentLang] || l.category).toLowerCase();

  return name.includes(searchQuery) || category.includes(searchQuery);
}

/* ================= FREE DARSHAN (STANDALONE) ================= */
function renderFreeDarshan() {
  const container = document.getElementById("free-darshan-container");
  container.innerHTML = "";

  const free = locationsData.find(
    l => l.category === "FREE_DARSHAN_COUNTER"
  );
  if (!free) return;

  const btn = document.createElement("button");
  btn.textContent =
    free["name_" + currentLang] || free["display name"];

  btn.onclick = () =>
    window.open(
      `https://www.google.com/maps/search/?api=1&query=${free.latitude},${free.longitude}`,
      "_blank"
    );

  btn.style.padding = "12px 16px";
  btn.style.fontSize = "16px";
  btn.style.fontWeight = "bold";
  btn.style.cursor = "pointer";

  container.appendChild(btn);
}

/* ================= BROWSE MODE ================= */
function renderApp() {
  renderFreeDarshan();

  const app = document.getElementById("app");
  app.innerHTML = "";
  app.style.display = "block";
  document.getElementById("search-results").style.display = "none";

  const grouped = {};
  locationsData
    .filter(l => l.category !== "FREE_DARSHAN_COUNTER")
    .forEach(l => (grouped[l.category] ||= []).push(l));

  for (const cat in grouped) {
    const section = document.createElement("section");

    const h = document.createElement("h2");
    h.textContent = CATEGORY_LABELS[cat]?.[currentLang] || cat;
    h.style.cursor = "pointer";

    const ul = document.createElement("ul");
    ul.style.display = "none";

    h.onclick = () => {
      const isOpen = ul.style.display === "block";

      document.querySelectorAll("#app ul").forEach(u => {
        u.style.display = "none";
      });

      ul.style.display = isOpen ? "none" : "block";
    };

    grouped[cat].forEach(l => {
      const li = document.createElement("li");

      const name = document.createElement("strong");
      name.textContent = l["name_" + currentLang] || l["display name"];
      name.style.cursor = "pointer";

      const details = document.createElement("div");
      details.style.display = "none";

      const btn = document.createElement("button");
      btn.textContent = "Open in Google Maps";
      btn.onclick = () =>
        window.open(
          `https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,
          "_blank"
        );

      details.append(btn);

      name.onclick = () => {
        const isOpen = details.style.display === "block";
        ul.querySelectorAll("div").forEach(d => d.style.display = "none");
        details.style.display = isOpen ? "none" : "block";
      };

      li.append(name, details);
      ul.append(li);
    });

    section.append(h, ul, document.createElement("hr"));
    app.append(section);
  }
}

/* ================= SEARCH MODE ================= */
function renderSearchResults() {
  const list = document.getElementById("search-list");
  list.innerHTML = "";

  const results = locationsData
    .filter(l => l.category !== "FREE_DARSHAN_COUNTER")
    .filter(matchesSearch);

  if (results.length === 0) {
    list.innerHTML = "<li>No matching locations found</li>";
  } else {
    results.forEach(l => {
      const li = document.createElement("li");

      const name = document.createElement("strong");
      name.textContent = l["name_" + currentLang] || l["display name"];
      name.style.cursor = "pointer";

      const details = document.createElement("div");
      details.style.display = "none";

      const btn = document.createElement("button");
      btn.textContent = "Navigate";
      btn.onclick = () =>
        window.open(
          `https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,
          "_blank"
        );

      details.append(btn);

      name.onclick = () => {
        const isOpen = details.style.display === "block";
        document.querySelectorAll("#search-list div").forEach(d => d.style.display = "none");
        details.style.display = isOpen ? "none" : "block";
      };

      li.append(name, details);
      list.append(li);
    });
  }

  document.getElementById("app").style.display = "none";
  document.getElementById("search-results").style.display = "block";
}

/* ================= EVENTS ================= */
document.getElementById("lang").addEventListener("change", e => {
  currentLang = e.target.value;
  searchQuery ? renderSearchResults() : renderApp();
});

document.getElementById("searchInput").addEventListener("input", e => {
  searchQuery = e.target.value.trim().toLowerCase();
  searchQuery ? renderSearchResults() : renderApp();
});

/* ================= BACK TO TOP VISIBILITY ================= */
document.addEventListener("DOMContentLoaded", () => {
  const backToTopBtn = document.getElementById("back-to-top");

  if (!backToTopBtn) {
    console.error("Back to top button not found");
    return;
  }

  window.addEventListener("scroll", () => {
    if (window.scrollY > 150) {
      backToTopBtn.style.display = "block";
    } else {
      backToTopBtn.style.display = "none";
    }
  });
});


</script>

<hr>

<footer id="temple-footer">
    <p style="font-size: 13px; color: #777; text-align:center;">
        Navigation is provided via Google Maps. Routes may vary based on traffic and conditions.
    </p>

    <p style="font-size: 13px; color: #777; text-align:center;">
        Last updated: July 2026
    </p>
</footer>

</body>
</html>

